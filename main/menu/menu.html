<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <title>Project ASAR</title>
    <link href="https://fonts.googleapis.com/css2?family=Quantico:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="menu.css">
</head>
<body>
    <h1 id="menu-title">Project ASAR</h1>
    <h1 id="versionLabel"></h1>
    <p id="online-players-count">Loading online players...</p>
    <a class="discord-btn" href="https://discord.gg/pncw85JUGw" target="_blank">
        <img src="download.png" alt="Discord">
        <span>Discord</span>
    </a>
    <a class="youtube-btn" href="https://www.youtube.com/watch?v=jNTWEaXbvEs" target="_blank">
  <img src="download (1).png" alt="YouTube">
  <span>YouTube</span>
</a>

    <script type="module" src="menu.js"></script>
    <button onclick="goToStoryMode()" class="button" id="story-mode-button">Story Mode</button>
    <button onclick="goToPlatformerMenu()" class="button" id="platformer-button">Platformer</button>
    <script>
        function goToPlatformerMenu() {
            window.location.href = "../../platformer/platformer-menu/platformer-menu.html";
        }
    </script>
    <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";
  // Import Realtime Database functions
  import { getDatabase, ref, set, onValue, onDisconnect } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyAMv09bDdv7AiP3XzbsJQ8TrYrTIJStSJ4",
    authDomain: "project-asar.firebaseapp.com",
    projectId: "project-asar",
    storageBucket: "project-asar.firebasestorage.app",
    messagingSenderId: "392198412298",
    appId: "1:392198412298:web:da61bd52f3028d7288a7f3",
    measurementId: "G-TFLFG0R06L"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app); // Keep analytics if you want it

  // --- Realtime Database for Online Players ---

  const db = getDatabase(app); // Get a reference to the Realtime Database service

  // Function to generate a unique ID for each session (player)
  function generateUniqueId() {
    return 'player_' + Date.now() + '_' + Math.random().toString(36).substring(2, 9);
  }

  const userId = generateUniqueId(); // Generate a unique ID for this player's session
  const userStatusRef = ref(db, 'presence/' + userId); // Reference to this player's status in the database
  const onlinePlayersRef = ref(db, 'presence'); // Reference to the entire 'presence' node

  // Set up what happens when the user disconnects (e.g., closes tab, loses internet)
  onDisconnect(userStatusRef).remove(); // Remove this player's presence from the database

  // Set this player's presence to 'online' when they connect
  set(userStatusRef, true); // You could also store a timestamp or username here

  // Listen for changes to the 'presence' node to count online players
  onValue(onlinePlayersRef, (snapshot) => {
    let onlinePlayersCount = 0;
    const data = snapshot.val(); // Get the raw data object from the snapshot

    if (data && typeof data === 'object') {
      onlinePlayersCount = Object.keys(data).length; // Count the number of keys in the data object
    }
    
    const onlinePlayersElement = document.getElementById('online-players-count');

    if (onlinePlayersElement) {
      onlinePlayersElement.textContent = `Online Players: ${onlinePlayersCount}`;
    }
    console.log("Current online players:", onlinePlayersCount);
  });

  // --- End Realtime Database for Online Players ---

</script>

</body>
        <!--scripts for menu buttons-->
        <script>
            function goToStoryMode() {
                window.location.href = "../story-mode/chapters-menu/chapters.html";
            }
        </script>
        <!--scripts for menu buttons-->
        
        <!--menu background-->

        <canvas id="rain"></canvas>
        <div class="overlay"></div>
        
        <script>
        (function(){
        const canvas = document.getElementById("rain");
        const ctx = canvas.getContext("2d");

        let width, height, dpr;
        let drops = [];

        let DROP_COUNT = 500;
        let WIND = -0.4;
        let SPEED_MULT = 1;

        function resize() {
            dpr = window.devicePixelRatio || 1;
            width = innerWidth;
            height = innerHeight;

            canvas.width = width * dpr;
            canvas.height = height * dpr;
            canvas.style.width = width + "px";
            canvas.style.height = height + "px";
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        }

        class Drop {
            constructor(z = Math.random()) {
                this.z = z;
                this.reset();
            }

            reset() {
                this.x = Math.random() * width;
                this.y = Math.random() * -height;
                this.length = 10 + this.z * 25;
                this.speed = (4 + this.z * 10) * SPEED_MULT;
                this.opacity = 0.2 + this.z * 0.6;
            }

            update() {
                this.x += WIND * this.z;
                this.y += this.speed;
                if (this.y > height) {
                    this.reset();
                    this.y = 0;
                }
            }

            draw() {
                ctx.strokeStyle = `rgba(180,200,255,${this.opacity})`;
                ctx.lineWidth = 1 + this.z;
                ctx.beginPath();
                ctx.moveTo(this.x, this.y);
                ctx.lineTo(this.x + WIND * 8, this.y + this.length);
                ctx.stroke();
            }
        }

        function init() {
            drops = [];
            for (let i = 0; i < DROP_COUNT; i++) {
                drops.push(new Drop());
            }
        }

        function animate() {
            ctx.clearRect(0, 0, width, height);
            for (const d of drops) {
                d.update();
                d.draw();
            }
            requestAnimationFrame(animate);
        }

        // Optional controls from the original effect are only wired if present
        const toggle = document.getElementById("toggle");
        const controls = document.getElementById("controls");

        if (toggle && controls) {
            toggle.onclick = () => {
                toggle.classList.toggle("open");
                controls.classList.toggle("open");
            };

            const amount = document.getElementById("amount");
            const wind = document.getElementById("wind");
            const speed = document.getElementById("speed");

            if (amount) amount.oninput = e => { DROP_COUNT = +e.target.value; init(); };
            if (wind) wind.oninput = e => { WIND = +e.target.value; };
            if (speed) speed.oninput = e => { SPEED_MULT = +e.target.value; drops.forEach(d => d.reset()); };
        }

        window.onresize = () => { resize(); init(); };

        resize();
        init();
        animate();
        })();
        </script>
</html>